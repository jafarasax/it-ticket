<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IT Ticket</title>
  <style>
    body{font-family:system-ui,Segoe UI,Tahoma,Arial; background:#0b1220; color:#e9eef7; margin:0; padding:24px;}
    .card{max-width:920px; margin:0 auto; background:#121a2b; border:1px solid #23304a; border-radius:16px; padding:18px 18px 24px;}
    h1{margin:6px 0 2px; font-size:22px;}
    .sub{opacity:.85; margin:0 0 16px; font-size:13px;}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px;}

    /* âœ… Ù„ÙŠØ¨Ù„ Ù…Ù† Ø¬Ù‡ØªÙŠÙ† */
    .label-dual{display:flex; justify-content:space-between; align-items:center; margin:10px 0 6px; opacity:.95; font-size:13px;}
    .label-dual .ar{direction:rtl; text-align:right;}
    .label-dual .en{direction:ltr; text-align:left; opacity:.8; font-size:12px;}

    select, input, textarea{width:100%; box-sizing:border-box; padding:10px 12px; border-radius:12px; border:1px solid #2a3a5a; background:#0f1729; color:#e9eef7; outline:none;}
    textarea{min-height:110px; resize:vertical;}
    .row{display:flex; gap:12px; flex-wrap:wrap;}
    .pill{padding:8px 10px; border:1px solid #2a3a5a; border-radius:999px; font-size:12px; opacity:.95; cursor:pointer; user-select:none;}
    .pill input{margin-left:6px;}
    .actions{display:flex; gap:10px; margin-top:16px;}
    button{padding:10px 14px; border-radius:12px; border:1px solid #2a3a5a; background:#1f4e79; color:#fff; cursor:pointer; font-weight:700;}
    button.secondary{background:transparent;}
    .note{font-size:12px; opacity:.8; margin-top:10px;}
    .hidden{display:none;}
    .topbar{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:10px; flex-wrap:wrap;}
    .chip{padding:8px 10px; border:1px solid #2a3a5a; border-radius:999px; font-size:12px; opacity:.95;}
    @media (max-width:760px){ .grid{grid-template-columns:1fr;} }
       .brand{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:10px;
}

/* âœ… ØªÙˆØ³ÙŠØ· Ø§Ù„Ù„ÙˆÚ¯Ùˆ ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¨Ø§Ù„Ù…Ù†ØªØµÙ) */
.brand-center{
  flex-direction:column;
  justify-content:center;
  text-align:center;
  margin-bottom:14px;
}

.brand .logo{
  width:120px;        /* Ù„Ù„Ù‘ÙˆÚ¯Ùˆ Ø§Ù„Ø¹Ø±ÙŠØ¶ */
  height:44px;
  border-radius:10px;
  border:1px solid #23304a;
  background:#0f1729;
  object-fit:contain;
  padding:6px;
  box-shadow:0 6px 16px rgba(0,0,0,.25);
}

/* âœ… Ù„ÙˆÙƒÙˆ Ø¨Ø§Ù„Ù…Ù†ØªØµÙ */
.brand-center .logo{
  margin:0 auto 6px;
}

/* âœ… Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media (max-width:760px){
  .brand-center .logo{
    width:168px;
    height:58px;
  }
}
.brand-center::after{
  content:"";
  width: 240px;
  height:4px;
  background:#23304a;
  margin:10px auto 0;
  border-radius:2px;
}





.brand .titles h1{margin:0; font-size:22px;}
.brand .titles .sub{margin:4px 0 0; opacity:.85; font-size:13px;}
.hidden{display:none;}
#loadingBox{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid #2a3a5a;
  background:#0f1729;
  font-weight:700;
  text-align:center;
  width:100%;
}
  </style>
</head>
<body>

<div class="card">

  <!-- ğŸ”µ Ø£ÙˆÙ„ Ø´ÙŠ ÙˆØ¨Ø§Ù„Ù…Ù†ØªØµÙ -->
  <div class="brand brand-center">
    <img class="logo" src="logo.png" alt="Logo">
    <div class="titles">
      <h1>Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h1>
      <p class="sub">IT Support</p>
    </div>
  </div>

  <!-- ğŸ”¹ Ø¨Ø¹Ø¯Ù‡Ø§ Ø§Ù„Ù€ Topbar -->
  <div class="topbar">
    <div class="chip" id="whoami">â€”</div>
    <button class="secondary" id="logoutBtn" type="button">Logout</button>
  </div>

  

    <div class="grid">
      <div>
        <label class="label-dual" for="os">
          <span class="ar">Ø§Ù„Ù†Ø¸Ø§Ù…</span>
          <span class="en">Select OS</span>
        </label>
        <select id="os" required>
          <option value="" selected disabled>Ø§Ø®ØªØ±â€¦</option>
          <option>Windows 11</option>
          <option>Windows 10</option>
          <option>Android</option>
          <option>Ubuntu Linux</option>
          <option>Windows Server</option>
           <option>Internet</option>
        </select>
      </div>

      <div>
        <label class="label-dual" for="ptype">
          <span class="ar">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</span>
          <span class="en">Problem Type</span>
        </label>
        <select id="ptype" required>
          <option value="" selected disabled>Ø§Ø®ØªØ±â€¦</option>
          <option value="Software">Software (Ø¨Ø±Ù…Ø¬ÙŠØ©)</option>
          <option value="Hardware">Hardware (Ø¹ØªØ§Ø¯ÙŠØ©)</option>
        </select>
      </div>
    </div>

    <div id="issuesBlock">
      <label class="label-dual">
        <span class="ar">Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</span>
        <span class="en">Issues (Multi-select)</span>
      </label>
      <div id="issues" class="row"></div>
    </div>

    <div class="grid">
      <div>
        <label class="label-dual" for="priority">
          <span class="ar">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</span>
          <span class="en">Priority</span>
        </label>
        <select id="priority" required>
          <option value="" selected disabled>Ø§Ø®ØªØ±â€¦</option>
           <option>Ù…Ù†Ø¬Ø²</option>
          <option>Ù…Ù†Ø®ÙØ¶</option>
          <option>Ù…ØªÙˆØ³Ø·</option>
          <option>Ø¹Ø§Ù„ÙŠ</option>
          <option>Ø­Ø±Ø¬</option>
        </select>
      </div>

      <div class="hidden">
  <label class="label-dual" for="name">
    <span class="ar">Ø§Ù„Ù…Ù†Ø³Ù‘Ù‚</span>
    <span class="en">name</span>
  </label>
  <input id="name" readonly />
</div>
    </div>

    <div class="grid">
      <div>
        <label class="label-dual" for="tech">
          <span class="ar">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</span>
          <span class="en">Select Unit</span>
        </label>
        <select id="tech">
          <option value="">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option>
          <option value="IT Support Unit">IT Support Unit</option>
          <option value="Network Operations Unit">Network Operations Unit</option>
          <option value="Printing Services Unit">Printing Services Unit</option>
        </select>
      </div>

      <div>
        <label class="label-dual" for="contact">
          <span class="ar">SN | ID | ÙƒÙˆØ¯ Ø§Ù„Ø¹ØªØ¨Ø©</span>
          <span class="en">Asset Code</span>
        </label>
        <input id="contact" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ø¹ØªØ¨Ø© Ø§Ùˆ Ø³Ø±ÙŠØ§Ù„" />
      </div>
    </div>

    <label class="label-dual" for="desc">
      <span class="ar">Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</span>
      <span class="en">Description</span>
    </label>
    <textarea id="desc" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„â€¦"></textarea>

 <div class="actions">
  <button id="submit" type="button">Submit</button>

  <div id="loadingBox" class="hidden">
    Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø±Ø³Ø§Ù„...
  </div>
</div>


    <div class="note" id="note"></div>
  </div>

<script>
  let loading=false; 
/* âœ… Ø­Ø±Ø§Ø³Ø©: Ù„Ø§Ø²Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ */
if (sessionStorage.getItem("logged_in") !== "1") {
  window.location.href = "login.html";
}

/* ğŸ”— Ø¶Ø¹ Ø±Ø§Ø¨Ø· Web App Ù‡Ù†Ø§ */
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzZWbjoaZYVu2ALRTESvoT0ZyqnsIQ9NU1dHsUQPhp7sTthtKX71ihTYE9sYnRUcFmq/exec";

/* âœ… Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ */
const LOGGED_USER = sessionStorage.getItem("logged_user") || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
document.getElementById("name").value = LOGGED_USER;
document.getElementById("whoami").textContent = "Logged in: " + LOGGED_USER;

/* Logout */
document.getElementById("logoutBtn").addEventListener("click", () => {
  sessionStorage.removeItem("logged_in");
  sessionStorage.removeItem("logged_user");
  window.location.href = "login.html";
});

/* ====== Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… ====== */
const issuesByOS = {
  "Windows 11": ["Ù„Ø§ ÙŠÙ‚Ù„Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù… (Boot)","ØªØ­Ø¯ÙŠØ« ÙØ§Ø´Ù„","Ø´Ø§Ø´Ø© Ø²Ø±Ù‚Ø§Ø¡ (BSOD)","Ø¨Ø·Ø¡ Ø´Ø¯ÙŠØ¯","Ù…Ø´ÙƒÙ„Ø© ØªØ¹Ø±ÙŠÙØ§Øª","Ù…Ø´ÙƒÙ„Ø© ØªÙØ¹ÙŠÙ„","Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© (No Display)","Ø§Ø±ØªÙØ§Ø¹ Ø­Ø±Ø§Ø±Ø©","Ø¹Ø·Ù„ Ù‚Ø±Øµ (SSD/HDD)","Ø®Ù„Ù„ RAM"],
  "Windows 10": ["Ù„Ø§ ÙŠÙ‚Ù„Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù… (Boot)","ØªØ­Ø¯ÙŠØ« ÙØ§Ø´Ù„","Ø´Ø§Ø´Ø© Ø²Ø±Ù‚Ø§Ø¡ (BSOD)","Ø¨Ø·Ø¡ Ø´Ø¯ÙŠØ¯","Ù…Ø´ÙƒÙ„Ø© ØªØ¹Ø±ÙŠÙØ§Øª","Ù…Ø´ÙƒÙ„Ø© ØªÙØ¹ÙŠÙ„","Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© (No Display)","Ø§Ø±ØªÙØ§Ø¹ Ø­Ø±Ø§Ø±Ø©","Ø¹Ø·Ù„ Ù‚Ø±Øµ (SSD/HDD)","Ø®Ù„Ù„ RAM"],
  "Android": ["ØªÙ‡Ù†ÙŠØ¬/Ø¨Ø·Ø¡","Ø§Ù†Ù‡ÙŠØ§Ø± ØªØ·Ø¨ÙŠÙ‚","Bootloop","Ù…Ø´ÙƒÙ„Ø© Ø´Ø­Ù†","ØªØ¹Ø·Ù„ Ù„Ù…Ø³","ÙƒØ¨Ù„ LAN Ù„Ø§ ÙŠØ¹Ù…Ù„","Ø§Ù…ØªÙ„Ø§Ø¡ Ù…Ø³Ø§Ø­Ø©"],
  "Ubuntu Linux": ["Ø®Ø·Ø£ GRUB","ÙØ´Ù„ ØªØ«Ø¨ÙŠØª Ø­Ø²Ù…","ØªØ¹Ø§Ø±Ø¶ Dependencies","Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ø§ ØªØ¹Ù…Ù„","Ù…Ø´ÙƒÙ„Ø© ØªØ¹Ø±ÙŠÙ ÙƒØ±Øª","Ø®Ø·Ø£ Mount Ù„Ù„Ù‚Ø±Øµ"],
  "Windows Server": ["Ù…Ø´ÙƒÙ„Ø© Active Directory","DNS/DHCP Ù„Ø§ ÙŠØ¹Ù…Ù„","Ø®Ø¯Ù…Ø© Ù…ØªÙˆÙ‚ÙØ©","Ù…Ø´ÙƒÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„/Ù…ØµØ§Ø¯Ù‚Ø©","ÙØ´Ù„ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ","Ù…Ø´ÙƒÙ„Ø© RAID","Ù…Ø´ÙƒÙ„Ø© Ø´Ø¨ÙƒØ©"],
   "Internet": [
    "ÙƒØ¨Ù„ LAN Ù„Ø§ ÙŠØ¹Ù…Ù„",
    "ÙŠÙˆØ¬Ø¯ ip Ù„Ø§ÙƒÙ† Ù„Ø§ÙŠÙˆØ¬Ø¯ Ø§Ù†ØªØ±Ù†ÙŠØª",
    "USR Ù…ØªØµÙ„ Ù„ÙƒÙ† Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ù†ØªØ±Ù†Øª",
    "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ù†ØªØ±Ù†Øª ÙÙŠ ÙƒÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©",
    "Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Hotspot (USR)",
    "PPPoE Ù„Ø§ ÙŠØ¹Ù…Ù„ (USR)",
    "Ø§Ù†Ù‚Ø·Ø§Ø¹ Ù…ØªÙƒØ±Ø±",
    "Ø¨Ø·Ø¡ Ø´Ø¯ÙŠØ¯ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª",
    "Ù„Ø§ ÙŠØ­ØµÙ„ IP Ù…Ù† DHCP"
  ]
};
const btn = document.getElementById("submit");
const loadingBox = document.getElementById("loadingBox");

function setLoading(state){
  if(state){
    btn.classList.add("hidden");        // Ø§Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø±
    loadingBox.classList.remove("hidden"); // Ø§Ø¸Ù‡Ø§Ø± Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø±Ø³Ø§Ù„
  }else{
    btn.classList.remove("hidden");
    loadingBox.classList.add("hidden");
  }
}

/* ====== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ ====== */
function renderIssues(){

  const os = document.getElementById('os').value;
  const wrap = document.getElementById('issues');
  wrap.innerHTML = '';
  (issuesByOS[os] || []).forEach((t)=>{
    const div = document.createElement('label');
    div.className = 'pill';
    div.innerHTML = `<input type="checkbox" value="${t}"> ${t}`;
    wrap.appendChild(div);
  });
}
document.getElementById('os').addEventListener('change', renderIssues);

/* ====== Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ====== */
function collect(){
  const issues = [...document.querySelectorAll('#issues input:checked')]
                  .map(x => x.value);

  const loggedUser = sessionStorage.getItem("logged_user") || "";

  return {
    os: document.getElementById('os').value,
    problemType: document.getElementById('ptype').value,
    issues: issues,
    priority: document.getElementById('priority').value,

    // ğŸ”’ Ù…Ø®ÙÙŠ ØªÙ…Ø§Ù…Ø§Ù‹
    coordinator: loggedUser,
    name: loggedUser, // Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù€ Apps Script Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„

    contact: document.getElementById('contact').value,
    technician: document.getElementById('tech').value,
    description: document.getElementById('desc').value,
    createdAt: new Date().toISOString()
  };
}



/* ====== Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Google Sheets ====== */
async function sendToSheet(payload){
  loading=true;
  const res = await fetch(WEBAPP_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify(payload)
  });
  loading=false;
  return await res.json();
}

document.getElementById('submit').addEventListener('click', async ()=>{
  const data = collect();

  if(!data.os || !data.problemType || !data.priority){
    alert('Ø±Ø¬Ø§Ø¡Ù‹ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (OS / Type / Priority)');
    return;
  }

  try {
    setLoading(true);

    const result = await sendToSheet(data);

    if(result.ok){
      alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…\nØ±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©: " + result.ticketId);
    }else{
      alert("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âŒ\n" + result.error);
    }

  } catch (e) {
    alert("Ø®Ø·Ø£ Ø§ØªØµØ§Ù„ âŒ\n" + e.message);

  } finally {
    setLoading(false);
  }
});

</script>

</body>
</html>
